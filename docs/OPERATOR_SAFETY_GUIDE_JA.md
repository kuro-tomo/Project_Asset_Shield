# 運用者安全ガイド - Silence Protocol V9.0

## 概要

本ドキュメントは、Asset Shieldの運用者の匿名性と物理的安全性を確保するためのセキュリティアーキテクチャについて説明します。

## 規約・制約の参照
セキュリティ・ガバナンスの必須要件は [`MASTER_CONSTITUTION.md`](../MASTER_CONSTITUTION.md) を一次情報とします。

**警告**: 本システムには破壊的な操作が含まれています。本番環境での使用前に、すべての機能を十分に理解してください。

---

## 1. Silence Protocol（沈黙プロトコル）

### 1.1 Dead Man's Switch（デッドマンスイッチ）

運用者からの定期的な「生存信号（Heartbeat）」が途絶えた場合、自動的にコアロジックを破壊し、証拠を隠滅するシステムです。

```
┌─────────────────────────────────────────────────────────────┐
│                    SILENCE PROTOCOL V9.0                     │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│   ┌──────────┐    Heartbeat    ┌──────────────┐            │
│   │ Operator │ ──────────────► │ Pulse File   │            │
│   └──────────┘    (定期送信)    │ .owner_pulse │            │
│                                 └──────────────┘            │
│                                        │                     │
│                                        ▼                     │
│                              ┌──────────────────┐           │
│                              │ Monitor Thread   │           │
│                              │ (60秒間隔チェック) │           │
│                              └──────────────────┘           │
│                                        │                     │
│                         Timeout?       │                     │
│                    ┌───────────────────┼───────────────┐    │
│                    │ YES               │ NO            │    │
│                    ▼                   ▼               │    │
│           ┌──────────────┐    ┌──────────────┐        │    │
│           │ TRIGGER      │    │ Continue     │        │    │
│           │ Silver Bullet│    │ Monitoring   │        │    │
│           └──────────────┘    └──────────────┘        │    │
│                    │                                   │    │
│                    ▼                                   │    │
│           ┌──────────────────────────────────┐        │    │
│           │ 1. PII Sanitization              │        │    │
│           │ 2. Secure Wipe (DoD 5220.22-M)   │        │    │
│           │ 3. Decoy Generation              │        │    │
│           │ 4. Log Destruction               │        │    │
│           └──────────────────────────────────┘        │    │
│                                                        │    │
└────────────────────────────────────────────────────────┘    │
```

### 1.2 トリガー条件

| トリガータイプ | 説明 | 発動条件 |
|--------------|------|---------|
| `HEARTBEAT_TIMEOUT` | 生存信号タイムアウト | 設定時間 + 猶予期間を超過 |
| `PANIC_BUTTON` | パニックボタン | 緊急コード入力 |
| `REMOTE_SIGNAL` | リモートシグナル | 外部APIからのkill信号 |
| `CANARY_DEATH` | カナリアファイル消失 | `.canary`ファイルの改ざん/削除 |
| `INTRUSION_DETECTED` | 侵入検知 | 不審なアクティビティ検出 |
| `DURESS_CODE` | 脅迫コード | 強制下での特殊コード入力 |

### 1.3 脅迫コード（Duress Code）

物理的な拘束下で強制的にシステムにアクセスさせられた場合、通常のパスワードの代わりに「脅迫コード」を入力することで、表面上は正常に動作しながら、バックグラウンドで証拠隠滅を開始します。

```python
# 通常のハートビート
silence.send_heartbeat()  # 正常動作

# 脅迫コードによるハートビート（見た目は正常、実際は自壊開始）
silence.send_heartbeat(code="ALPHA-SAFE")  # 静かに自壊開始
```

---

## 2. セキュアワイプ（Secure Wipe）

### 2.1 ワイプ方式

| 方式 | パス数 | 説明 | 推奨用途 |
|-----|-------|------|---------|
| `SIMPLE` | 1 | ランダムデータ1回上書き | 緊急時 |
| `DOD_3PASS` | 3 | DoD 5220.22-M短縮版 | **推奨** |
| `DOD_7PASS` | 7 | DoD 5220.22-M拡張版 | 高セキュリティ |
| `GUTMANN` | 35 | Gutmann方式 | 最高セキュリティ |

### 2.2 ワイプ手順

```
┌─────────────────────────────────────────────────────────────┐
│                    SECURE WIPE PROCESS                       │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│   Pass 1: 0x00 (All Zeros)                                  │
│   ────────────────────────────────────────────────────────  │
│   [████████████████████████████████████████] 100%           │
│                                                              │
│   Pass 2: 0xFF (All Ones)                                   │
│   ────────────────────────────────────────────────────────  │
│   [████████████████████████████████████████] 100%           │
│                                                              │
│   Pass 3: Random Data                                        │
│   ────────────────────────────────────────────────────────  │
│   [████████████████████████████████████████] 100%           │
│                                                              │
│   Rename: brain.py → a7f3b2c1d9e8f0a1.tmp                   │
│   Rename: a7f3b2c1d9e8f0a1.tmp → 4e5d6c7b8a9f0e1d.tmp       │
│   Rename: 4e5d6c7b8a9f0e1d.tmp → 1a2b3c4d5e6f7g8h.tmp       │
│                                                              │
│   Delete: 1a2b3c4d5e6f7g8h.tmp                              │
│                                                              │
│   [✓] File securely destroyed                               │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. PII（個人特定情報）サニタイズ

### 3.1 検出パターン

システムは以下のパターンを自動検出します：

- **メールアドレス**: `user@example.com`
- **電話番号**: `090-1234-5678`
- **IPアドレス**: `192.168.1.1`
- **パスポート番号**: `AB1234567`
- **APIキー/パスワード**: `api_key=xxxxx`

### 3.2 使用方法

```bash
# PIIスキャン（検出のみ）
python scripts/silence_protocol.py scan --verbose

# PIIスキャン + 自動サニタイズ
python scripts/silence_protocol.py scan --sanitize
```

---

## 4. デコイ生成（Decoy Generation）

重要ファイルを削除する代わりに、無害なダミーコードで置き換えます。これにより、ファイルの「不自然な消失」を隠蔽します。

### 4.1 デコイ例

**オリジナル `brain.py`（破壊前）:**
```python
class ShieldBrain:
    def calculate_confidence(self, prices):
        # 高度な機械学習アルゴリズム
        return self._proprietary_algorithm(prices)
```

**デコイ `brain.py`（破壊後）:**
```python
"""
Simple moving average calculator for stock analysis.
Basic implementation for educational purposes.
"""

def calculate_sma(prices, window=20):
    """Calculate Simple Moving Average"""
    return sum(prices[-window:]) / window
```

---

## 5. 運用手順

### 5.1 初期化

```bash
# Silence Protocolの初期化
python scripts/silence_protocol.py init --interval 3600 --secure

# 出力:
# [*] Initializing Silence Protocol V9.0...
# [+] Heartbeat file created: .owner_pulse
# [+] Canary file created: .canary
# [+] Canary file created: .integrity
# [+] Silence Protocol initialized successfully.
# [!] Heartbeat required every 3600 seconds.
```

### 5.2 定期ハートビート

```bash
# 手動ハートビート送信
python scripts/silence_protocol.py heartbeat

# cronによる自動ハートビート（推奨）
# crontab -e
# */30 * * * * cd /path/to/project && python scripts/silence_protocol.py heartbeat
```

### 5.3 ステータス確認

```bash
python scripts/silence_protocol.py status

# 出力:
# [*] Silence Protocol Status
# ========================================
# [+] Heartbeat: ACTIVE
#     Last beat: 2026-01-28T09:30:00
#     Age: 1800 seconds
#     Time until trigger: 2100 seconds
#
# [*] Canary Files:
#     [+] .canary: OK
#     [+] .integrity: OK
```

### 5.4 緊急停止（パニックボタン）

```bash
# パニックボタン発動（確認あり）
python scripts/silence_protocol.py panic

# パニックボタン発動（確認なし - 緊急時）
python scripts/silence_protocol.py panic --force --code "OMEGA-ZERO"
```

### 5.5 デーモンモード

```bash
# バックグラウンドで監視を継続
python scripts/silence_protocol.py daemon --interval 1800
```

---

## 6. 通信経路の匿名化

### 6.1 推奨構成

```
┌─────────────────────────────────────────────────────────────┐
│                    ANONYMIZATION LAYER                       │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│   ┌──────────┐                                              │
│   │ Operator │                                              │
│   └────┬─────┘                                              │
│        │                                                     │
│        ▼                                                     │
│   ┌──────────────┐                                          │
│   │ VPN Layer 1  │  (商用VPN - NordVPN/Mullvad)            │
│   └──────┬───────┘                                          │
│          │                                                   │
│          ▼                                                   │
│   ┌──────────────┐                                          │
│   │ Tor Network  │  (オプション - 高遅延許容時)             │
│   └──────┬───────┘                                          │
│          │                                                   │
│          ▼                                                   │
│   ┌──────────────┐                                          │
│   │ VPN Layer 2  │  (自己管理VPS - 別法域)                  │
│   └──────┬───────┘                                          │
│          │                                                   │
│          ▼                                                   │
│   ┌──────────────┐                                          │
│   │ J-Quants API │                                          │
│   └──────────────┘                                          │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 API通信のベストプラクティス

1. **User-Agentのランダム化**: 一般的なブラウザを模倣
2. **リクエスト間隔のジッター**: 機械的なパターンを回避
3. **IPローテーション**: 定期的なVPN切り替え
4. **ログの即時削除**: 通信ログを保持しない

---

## 7. 緊急時対応フロー

```
┌─────────────────────────────────────────────────────────────┐
│                    EMERGENCY RESPONSE                        │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│   [状況1] 通常の緊急停止                                     │
│   ─────────────────────────────────────────────────────────  │
│   1. パニックコード入力: OMEGA-ZERO                          │
│   2. 即座にシステム自壊開始                                   │
│   3. デコイファイル生成                                       │
│                                                              │
│   [状況2] 物理的拘束下                                       │
│   ─────────────────────────────────────────────────────────  │
│   1. 脅迫コード入力: ALPHA-SAFE                              │
│   2. 表面上は正常動作                                         │
│   3. バックグラウンドで静かに自壊                             │
│                                                              │
│   [状況3] 通信途絶                                           │
│   ─────────────────────────────────────────────────────────  │
│   1. ハートビートタイムアウト検知                             │
│   2. 猶予期間（5分）経過                                      │
│   3. 自動的にシステム自壊                                     │
│                                                              │
│   [状況4] 外部からの緊急停止                                  │
│   ─────────────────────────────────────────────────────────  │
│   1. SIGUSR1シグナル送信: kill -USR1 <PID>                   │
│   2. または、リモートAPIからkill信号                          │
│   3. 即座にシステム自壊                                       │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 8. セキュリティチェックリスト

### 8.1 デプロイ前

- [ ] すべてのPIIがサニタイズされていることを確認
- [ ] ハートビート間隔が適切に設定されていることを確認
- [ ] カナリアファイルが配置されていることを確認
- [ ] パニックコードと脅迫コードを安全に記憶
- [ ] VPN/プロキシ構成が正しいことを確認

### 8.2 運用中

- [ ] 定期的なハートビート送信を確認
- [ ] ログファイルの定期的な削除
- [ ] 通信パターンの監視
- [ ] カナリアファイルの整合性確認

### 8.3 緊急時

- [ ] パニックコードの即座の入力が可能
- [ ] 脅迫コードの使用タイミングを理解
- [ ] バックアップの安全な保管場所を確認

---

## 9. 免責事項

本システムは、正当な目的（知的財産保護、企業秘密保護）のために設計されています。違法な目的での使用は固く禁じられています。

**最終更新**: 2026年1月28日
**バージョン**: 9.0.0
